<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Src</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.12.3/application.js' type='text/javascript'></script>
    <link href='./assets/0.12.3/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="shortcut icon" type="image/png" href="./assets/0.12.3/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.12.3/favicon.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.12.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2024-05-03T14:10:22+00:00">2024-05-03T14:10:22+00:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  35.28%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.99
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>11</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>513</b> relevant lines,
    <span class="green"><b>181</b> lines covered</span> and
    <span class="red"><b>332</b> lines missed. </span>
    (<span class="red">
  35.28%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0ff0b90d7f3e58197ffbb081fa1286a5d63a89e7" class="src_link" title="app.rb">app.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#656df199eeeb35b9c02db77e22b144d078de8abb" class="src_link" title="controllers/general.rb">controllers/general.rb</a></td>
            <td class="red strong cell--number t-file__coverage">52.77 %</td>
            <td class="cell--number">352</td>
            <td class="cell--number">235</td>
            <td class="cell--number">124</td>
            <td class="cell--number">111</td>
            <td class="cell--number">1.93</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ea79c9f95df7e2f9ecb8682a491ae83273e20a4d" class="src_link" title="controllers/staff_controller.rb">controllers/staff_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">10.34 %</td>
            <td class="cell--number">226</td>
            <td class="cell--number">145</td>
            <td class="cell--number">15</td>
            <td class="cell--number">130</td>
            <td class="cell--number">0.10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ac583053f67aee1c99a61219262a265bebf2d3e6" class="src_link" title="controllers/store_controller.rb">controllers/store_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">58.33 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">12</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0.58</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#570b775bd3ca6a914792909dac054b6cbcb5f794" class="src_link" title="controllers/story_controller.rb">controllers/story_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">10.23 %</td>
            <td class="cell--number">138</td>
            <td class="cell--number">88</td>
            <td class="cell--number">9</td>
            <td class="cell--number">79</td>
            <td class="cell--number">0.10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7a2cde6acafe469032eea23dbdad1751dc79cb57" class="src_link" title="models/ActivatedCampaign.rb">models/ActivatedCampaign.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1d271a246662da031ef6027f3eb9b1b58a9886aa" class="src_link" title="models/BoughtStory.rb">models/BoughtStory.rb</a></td>
            <td class="red strong cell--number t-file__coverage">66.67 %</td>
            <td class="cell--number">8</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.67</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#237e447ff0850f9fccd566f7a7eb322d32d42fda" class="src_link" title="models/PromotionalCapaign.rb">models/PromotionalCapaign.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d2c03c488e374f097ea101d3e5e8c18c3da28c5d" class="src_link" title="models/StaffContact.rb">models/StaffContact.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ab210097585b706a7d30d3e56a74b0ec7def4eb8" class="src_link" title="models/Story.rb">models/Story.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f7c857a1d0aa15ee14cea20d0867a6c6244d5d3f" class="src_link" title="models/User.rb">models/User.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">14</td>
            <td class="cell--number">9</td>
            <td class="cell--number">3</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.33</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.12.3<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="0ff0b90d7f3e58197ffbb081fa1286a5d63a89e7">
  <div class="header">
    <h3>app.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># Gems</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;sinatra&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;logger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;sequel&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;sqlite3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># So we can escape HTML special characters in the view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">include ERB::Util</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"># Database</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">mode = ENV.fetch(&quot;APP_ENV&quot;, &quot;development&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">path = File.dirname(__FILE__)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">file_minus_ext = &quot;#{path}/#{mode}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">DB = Sequel.sqlite(&quot;database.sqlite3&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby"># Sessions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">enable :sessions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"># Models</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">require_rel &quot;models&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"># App</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">require_rel &quot;controllers&quot;</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="656df199eeeb35b9c02db77e22b144d078de8abb">
  <div class="header">
    <h3>controllers/general.rb</h3>
    <h4>
      <span class="red">
  52.77%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>235</b> relevant lines.
      <span class="green"><b>124</b> lines covered</span> and
      <span class="red"><b>111</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/common/header&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            
            

            

            <code class="ruby">  erb :header</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @myTitle = &quot;Home&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">  num_stories=Story.all.count() #use if we randomise the home page stories or implement likes into stories and choose most liked</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @stories = Story.all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  #@firstID = 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">  #@secondID = 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">  #@thirdID =  3</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  #@firstTitle = Story.first(storyid: @firstID).title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">  #@secondTitle = Story.first(storyid: @secondID).title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  #@thirdTitle = Story.first(storyid: @thirdID).title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :home</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/promotions&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @myTitle = &quot;Promotional Campaigns&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :promotional_campaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/login&quot; do </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @database = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">    begin </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">        db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            <span class="hits">1</span>
            

            

            <code class="ruby">        sql = &quot;SELECT * FROM users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @database = db.execute(sql)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">        @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">        db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            <span class="hits">1</span>
            

            

            <code class="ruby">    erb :login_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/account-settings&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @myTitle = &quot;Account Settings&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :account_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/contact-staff&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">  @myTitle = &quot;Account Settings&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            
            

            

            <code class="ruby">  erb :staff_contact_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/create-account&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :create_account</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/create-account&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="54">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @username = params.fetch(&quot;username&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="55">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @password = params.fetch(&quot;password&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="56">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @confirm_password = params.fetch(&quot;confirm_password&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="57">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @dob = params.fetch(&quot;dob&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            <span class="hits">10</span>
            

            

            <code class="ruby">    Date.parse(@dob)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="59">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @email = params.fetch(&quot;email&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="60">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @account_type = params.fetch(&quot;account_type&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="61">
            <span class="hits">10</span>
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="63">
            <span class="hits">10</span>
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="64">
            <span class="hits">10</span>
            

            

            <code class="ruby">      sql = &quot;SELECT * FROM users WHERE email = ? LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="65">
            <span class="hits">10</span>
            

            

            <code class="ruby">      check_email = db.execute(sql,@email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="66">
            <span class="hits">10</span>
            

            

            <code class="ruby">      sql = &quot;SELECT * FROM users WHERE username = ? LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="67">
            <span class="hits">10</span>
            

            

            <code class="ruby">      check_username = db.execute(sql, @username)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="68">
            <span class="hits">10</span>
            

            

            <code class="ruby">      if !check_username.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error=&quot;Username already taken&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="70">
            <span class="hits">9</span>
            

            

            <code class="ruby">      elsif @password!=@confirm_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error=&quot;Ensure that the passwords match&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="72">
            <span class="hits">8</span>
            

            

            <code class="ruby">      elsif get_password_strength(@password) &lt; 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error=&quot;Password is too weak. Password strength is &quot;+get_password_strength(@password).to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            <span class="hits">1</span>
            

            

            <code class="ruby">        +&quot;. Password strength should be at least 3.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="75">
            <span class="hits">7</span>
            

            

            <code class="ruby">      elsif @dob.empty? || Date.parse(@dob) &gt; Date.today - (13 * 365.25)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error=&quot;Invalid Date of Birth&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="77">
            <span class="hits">6</span>
            

            

            <code class="ruby">      elsif !check_email.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error=&quot;Email already in use&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="79">
            <span class="hits">5</span>
            

            

            <code class="ruby">      elsif @account_type.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">        @error=&quot;Choose an account type! Reader or Writer.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="82">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user=User.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="83">
            <span class="hits">5</span>
            

            

            <code class="ruby">        numusers=User.all.count()</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="84">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.userid=numusers+1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="85">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.username=@username</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="86">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.password=@password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="87">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.email=@email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="88">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.dateofbirth=@dob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="89">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.type=@account_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="90">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.premium=0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="91">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.popcorns=0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="92">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.activediscount=1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="93">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.interactions=0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="94">
            <span class="hits">5</span>
            

            

            <code class="ruby">        user.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="95">
            <span class="hits">5</span>
            

            

            <code class="ruby">        session[&quot;logged_in&quot;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="96">
            <span class="hits">5</span>
            

            

            <code class="ruby">        session[&quot;items&quot;] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="97">
            <span class="hits">5</span>
            

            

            <code class="ruby">        if @account_type==&quot;reader&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="98">
            <span class="hits">5</span>
            

            

            <code class="ruby">          session[&quot;type&quot;] = &quot;reader&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">        elsif @account_type==&quot;writer&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">          session[&quot;type&quot;] = &quot;writer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">        elsif @account_type==&quot;admin&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">          session[&quot;type&quot;] = &quot;admin&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">        elsif @account_type==&quot;manager&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">          session[&quot;type&quot;] = &quot;manager&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="106">
            <span class="hits">5</span>
            

            

            <code class="ruby">        sql = &quot;SELECT userid FROM users WHERE username = ? LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="107">
            <span class="hits">5</span>
            

            

            <code class="ruby">        session[&quot;currentuser&quot;] = db.execute(sql,@username)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="108">
            <span class="hits">5</span>
            

            

            <code class="ruby">        redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="113">
            <span class="hits">10</span>
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="115">
            <span class="hits">5</span>
            

            

            <code class="ruby">    erb :create_account</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">def get_password_strength(password)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="119">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="120">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength += 1 if password.length &gt;= 8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="121">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength += 1 if password.match?(/[A-Z]/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="122">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength += 1 if password.match?(/[a-z]/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="123">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength += 1 if password.match?(/\d/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="124">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength += 1 if password.match?(/[!@#$%^&amp;*]/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="125">
            <span class="hits">9</span>
            

            

            <code class="ruby">  strength</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/login&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="129">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @username = params.fetch(&quot;username&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="130">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @password = params.fetch(&quot;password&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="131">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="133">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if @username != &quot;&quot; and @password != &quot;&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="134">
            <span class="hits">3</span>
            

            

            <code class="ruby">      if !User.where(username: @username).empty? then</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="136">
            <span class="hits">2</span>
            

            

            <code class="ruby">        entered_password=User.first(username: @username).password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="137">
            <span class="hits">2</span>
            

            

            <code class="ruby">        type=User.first(username: @username).type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="139">
            <span class="hits">2</span>
            

            

            <code class="ruby">        if @password==entered_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            <span class="hits">1</span>
            

            

            <code class="ruby">          session[&quot;logged_in&quot;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            <span class="hits">1</span>
            

            

            <code class="ruby">          session[&quot;items&quot;] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            <span class="hits">1</span>
            

            

            <code class="ruby">          if type==&quot;reader&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            <span class="hits">1</span>
            

            

            <code class="ruby">            session[&quot;type&quot;] = &quot;reader&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">          elsif type==&quot;writer&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">            session[&quot;type&quot;] = &quot;writer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">          elsif type==&quot;admin&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">            session[&quot;type&quot;] = &quot;admin&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">          elsif type==&quot;manager&quot; then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">            session[&quot;type&quot;] = &quot;manager&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="152">
            <span class="hits">1</span>
            

            

            <code class="ruby">          session[&quot;currentuser&quot;] = User.first(username: @username).userid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            <span class="hits">1</span>
            

            

            <code class="ruby">          updateCampaigns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="154">
            <span class="hits">1</span>
            

            

            <code class="ruby">          redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="156">
            <span class="hits">1</span>
            

            

            <code class="ruby">          @error = &quot;Password incorrect&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="159">
            <span class="hits">1</span>
            

            

            <code class="ruby">        @error = &quot;Username incorrect&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @error = &quot;Please ensure all fields have been filled in&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="164">
            <span class="hits">3</span>
            

            

            <code class="ruby">    erb :login_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/logout&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="168">
            <span class="hits">3</span>
            

            

            <code class="ruby">    session.clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="169">
            <span class="hits">3</span>
            

            

            <code class="ruby">    redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="172">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/update-profile&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">    @username = params.fetch(&quot;username&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            
            

            

            <code class="ruby">    @email = params.fetch(&quot;email&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">    sql = &quot;UPDATE users SET username = ?, email = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">    db.execute(sql,@username,@email,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="181">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">  erb :account_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="188">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/change-password&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            
            

            

            <code class="ruby">  @currentpassword = params.fetch(&quot;currentPassword&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">  @newpassword = params.fetch(&quot;newPassword&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            
            

            

            <code class="ruby">  @confirmpassword = params.fetch(&quot;confirmPassword&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            
            

            

            <code class="ruby">  @error=nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            
            

            

            <code class="ruby">    sql = &quot;SELECT password FROM users WHERE userid = ? ORDER BY userid LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">    @checkpass=db.get_first_value(sql,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            
            

            

            <code class="ruby">    if @checkpass!=@currentpassword</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            
            

            

            <code class="ruby">      @error=&quot;Passwords Incorrect&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            
            

            

            <code class="ruby">    elsif @newpassword!=@confirmpassword</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            
            

            

            <code class="ruby">      @error=&quot;Passwords do not match&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            
            

            

            <code class="ruby">      sql = &quot;UPDATE users SET password = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            
            

            

            <code class="ruby">      db.execute(sql,@newpassword,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="208">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            
            

            

            <code class="ruby">  erb :account_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/delete-self&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="214">
            
            

            

            <code class="ruby">  @error=nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            
            

            

            <code class="ruby">    if session[&quot;currentuser&quot;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            
            

            

            <code class="ruby">        @error=&quot;Usernot logged in&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="219">
            
            

            

            <code class="ruby">  db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            
            

            

            <code class="ruby">  sql = &quot;DELETE FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            
            

            

            <code class="ruby">  db.execute(sql,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="223">
            
            

            

            <code class="ruby">  @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            
            

            

            <code class="ruby">  db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="227">
            
            

            

            <code class="ruby">session.clear</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="228">
            
            

            

            <code class="ruby">redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="229">
            
            

            

            <code class="ruby">erb :account_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="232">
            <span class="hits">1</span>
            

            

            <code class="ruby">def checkIfTop10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="234">
            <span class="hits">1</span>
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="235">
            <span class="hits">1</span>
            

            

            <code class="ruby">      ten_percent = (0.1*User.all.count()).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="236">
            <span class="hits">1</span>
            

            

            <code class="ruby">      sql = &quot;SELECT userid, interactions FROM users ORDER BY interactions DESC LIMIT ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="237">
            <span class="hits">1</span>
            

            

            <code class="ruby">      users_array = db.execute(sql,ten_percent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="238">
            <span class="hits">2</span>
            

            

            <code class="ruby">      top_10_userids = users_array.map { |user| user[0] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="239">
            <span class="hits">1</span>
            

            

            <code class="ruby">      if top_10_userids.include?(session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="240">
            
            

            

            <code class="ruby">        return true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="242">
            <span class="hits">1</span>
            

            

            <code class="ruby">        return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="245">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="247">
            <span class="hits">1</span>
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="251">
            <span class="hits">1</span>
            

            

            <code class="ruby">def checkIfCampaignAvailable</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="253">
            
            

            

            <code class="ruby">        db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="254">
            
            

            

            <code class="ruby">        sql = &quot;SELECT * FROM promotional_campaigns WHERE startdate &lt; ? AND enddate &gt; ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="255">
            
            

            

            <code class="ruby">        campaigns = db.execute(sql,Date.today.strftime(&quot;%Y-%m-%d&quot;),Date.today.strftime(&quot;%Y-%m-%d&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="256">
            
            

            

            <code class="ruby">        if !campaigns.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            
            

            

            <code class="ruby">            return true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            
            

            

            <code class="ruby">        else </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="259">
            
            

            

            <code class="ruby">            return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="261">
            
            

            

            <code class="ruby">      rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="262">
            
            

            

            <code class="ruby">        @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="264">
            
            

            

            <code class="ruby">        db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="268">
            <span class="hits">1</span>
            

            

            <code class="ruby">def getActiveCampaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="270">
            
            

            

            <code class="ruby">        db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="271">
            
            

            

            <code class="ruby">          sql = &quot;SELECT title, content, startdate, enddate, discount, campaignid  FROM promotional_campaigns WHERE startdate &lt; ? AND enddate &gt; ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="272">
            
            

            

            <code class="ruby">          result = db.execute(sql,Date.today.strftime(&quot;%Y-%m-%d&quot;),Date.today.strftime(&quot;%Y-%m-%d&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="273">
            
            

            

            <code class="ruby">          @campaign_list = result.map do |row|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            
            

            

            <code class="ruby">            {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="275">
            
            

            

            <code class="ruby">              title: row[0], </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            
            

            

            <code class="ruby">              content: row[1],  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            
            

            

            <code class="ruby">              startdate: row[2],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            
            

            

            <code class="ruby">              enddate: row[3],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            
            

            

            <code class="ruby">              discount: row[4],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            
            

            

            <code class="ruby">              campaignid: row[5],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            
            

            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="283">
            
            

            

            <code class="ruby">      rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="284">
            
            

            

            <code class="ruby">        @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            
            

            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="286">
            
            

            

            <code class="ruby">        db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="290">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def checkIfNotActive</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="292">
            
            

            

            <code class="ruby">            db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="293">
            
            

            

            <code class="ruby">            sql = &quot;SELECT * FROM activated_campaigns WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="294">
            
            

            

            <code class="ruby">            campaigns = db.execute(sql,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="295">
            
            

            

            <code class="ruby">            if campaigns.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="296">
            
            

            

            <code class="ruby">                return true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            
            

            

            <code class="ruby">            else </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="298">
            
            

            

            <code class="ruby">                return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            
            

            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="300">
            
            

            

            <code class="ruby">          rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="301">
            
            

            

            <code class="ruby">            @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            
            

            

            <code class="ruby">          ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="303">
            
            

            

            <code class="ruby">            db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="307">
            <span class="hits">1</span>
            

            

            <code class="ruby">    get &quot;/activateDiscount/:campaignid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="308">
            
            

            

            <code class="ruby">      campaign_id = params[:campaignid].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="310">
            
            

            

            <code class="ruby">            db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="311">
            
            

            

            <code class="ruby">             sql = &quot;SELECT activediscount FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="312">
            
            

            

            <code class="ruby">             current_discount = db.get_first_value(sql,session[&quot;userfound&quot;]).to_f</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="313">
            
            

            

            <code class="ruby">             sql = &quot;SELECT discount FROM promotional_campaigns WHERE campaignid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="314">
            
            

            

            <code class="ruby">             applied_discount = db.get_first_value(sql,campaign_id).to_f</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="315">
            
            

            

            <code class="ruby">             new_discount = current_discount * applied_discount</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="316">
            
            

            

            <code class="ruby">              sql = &quot;UPDATE users SET activediscount = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="317">
            
            

            

            <code class="ruby">              db.execute(sql,new_discount,session[&quot;userfound&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="318">
            
            

            

            <code class="ruby">              sql = &quot;SELECT enddate FROM promotional_campaigns WHERE campaignid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="319">
            
            

            

            <code class="ruby">              end_date = db.get_first_value(sql,campaign_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="320">
            
            

            

            <code class="ruby">              active_campaign=ActivatedCampaign.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="321">
            
            

            

            <code class="ruby">            active_campaign.campaignid=campaign_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="322">
            
            

            

            <code class="ruby">            active_campaign.userid=session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="323">
            
            

            

            <code class="ruby">            active_campaign.enddate=end_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            
            

            

            <code class="ruby">            active_campaign.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="325">
            
            

            

            <code class="ruby">            redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            
            

            

            <code class="ruby">          rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="327">
            
            

            

            <code class="ruby">            @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            
            

            

            <code class="ruby">          ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="329">
            
            

            

            <code class="ruby">            db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="333">
            <span class="hits">1</span>
            

            

            <code class="ruby">def updateCampaigns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="335">
            <span class="hits">1</span>
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="336">
            <span class="hits">1</span>
            

            

            <code class="ruby">    sql = &quot;SELECT campaignid FROM activated_campaigns WHERE userid = ? AND enddate &lt; ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="337">
            <span class="hits">1</span>
            

            

            <code class="ruby">    campaign = db.get_first_value(sql,session[&quot;currentuser&quot;],Date.today.strftime(&quot;%Y-%m-%d&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="338">
            <span class="hits">1</span>
            

            

            <code class="ruby">    if !campaign.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="339">
            
            

            

            <code class="ruby">      sql = &quot;SELECT discount FROM promotional_campaigns WHERE campaignid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="340">
            
            

            

            <code class="ruby">      discount = db.get_first_value(sql,campaign)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="341">
            
            

            

            <code class="ruby">      sql = &quot;SELECT activediscount FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="342">
            
            

            

            <code class="ruby">      current_discount = db.get_first_value(sql,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="343">
            
            

            

            <code class="ruby">      update_discount = current_discount/discount</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="344">
            
            

            

            <code class="ruby">      sql = &quot;UPDATE users SET activediscount = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="345">
            
            

            

            <code class="ruby">      db.execute(sql,update_discount,session[&quot;currentuser&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="347">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="348">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="350">
            <span class="hits">1</span>
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ea79c9f95df7e2f9ecb8682a491ae83273e20a4d">
  <div class="header">
    <h3>controllers/staff_controller.rb</h3>
    <h4>
      <span class="red">
  10.34%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>145</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>130</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/staff-actions&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @myTitle = &quot;Staff Actions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/staff-tickets&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  @myTitle = &quot;Staff Tickets&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  erb :staff_tickets</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/find-user&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            
            

            

            <code class="ruby">    @chosenusername = params.fetch(&quot;username&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      sql = &quot;SELECT userid FROM users WHERE username = ? LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">      usersID = db.execute(sql,@chosenusername)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">      if usersID.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            
            

            

            <code class="ruby">        session[&quot;userfound&quot;] = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        @error=&quot;Username not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">       else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        session[&quot;userfound&quot;] = usersID</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/find-story&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    @chosenstory = params.fetch(&quot;storyid&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">      sql = &quot;SELECT storyid FROM stories WHERE storyid = ? LIMIT 1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            
            

            

            <code class="ruby">      storyID = db.execute(sql,@chosenstory)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            
            

            

            <code class="ruby">      if storyID.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            
            

            

            <code class="ruby">        session[&quot;storyfound&quot;] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">        @error=&quot;Story ID not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">       else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">        session[&quot;storyfound&quot;] = storyID</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/delete-account&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">        if session[&quot;userfound&quot;].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">            @error=&quot;Username not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">      sql = &quot;DELETE FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">      db.execute(sql,session[&quot;userfound&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">    session[&quot;userfound&quot;] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/delete-story&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">        if session[&quot;storyfound&quot;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            
            

            

            <code class="ruby">            @error=&quot;Story not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">      sql = &quot;DELETE FROM stories WHERE storyid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            
            

            

            <code class="ruby">      db.execute(sql,session[&quot;storyfound&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">    session[&quot;storyfound&quot;] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/edit-story&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">  #temporary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">  redirect &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/edit-popcorns&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">  @popcorncount=params.fetch(&quot;popcorns&quot;,&quot;&quot;).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">  @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">        if session[&quot;userfound&quot;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">            @error=&quot;User not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">      sql = &quot;SELECT popcorns FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">      currentpopcorns = db.get_first_value(sql,session[&quot;userfound&quot;]).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">      totalpopcorns = @popcorncount + currentpopcorns</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">      sql = &quot;UPDATE users SET popcorns = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">      db.execute(sql,totalpopcorns,session[&quot;userfound&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            
            

            

            <code class="ruby">    session[&quot;userfound&quot;] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/change-type&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            
            

            

            <code class="ruby">  account_type = params.fetch(&quot;account_type&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">        if session[&quot;userfound&quot;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">            @error=&quot;User not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            
            

            

            <code class="ruby">      sql = &quot;UPDATE users SET type = ? WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">      db.execute(sql,account_type,session[&quot;userfound&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            
            

            

            <code class="ruby">    session[&quot;userfound&quot;] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/send-form&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            
            

            

            <code class="ruby">    email = params.fetch(&quot;email&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            
            

            

            <code class="ruby">    title = params.fetch(&quot;formember&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            
            

            

            <code class="ruby">    body = params.fetch(&quot;feedback&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            
            

            

            <code class="ruby">        db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            
            

            

            <code class="ruby">        contact=StaffContact.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            
            

            

            <code class="ruby">        numcontacts=StaffContact.all.count()</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            
            

            

            <code class="ruby">        if !session[&quot;currentuser&quot;].nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            
            

            

            <code class="ruby">            contact.requestid=numcontacts+1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            
            

            

            <code class="ruby">            contact.userid=session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            
            

            

            <code class="ruby">            contact.email=email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            
            

            

            <code class="ruby">            contact.title=title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            
            

            

            <code class="ruby">            contact.feedback=body</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            
            

            

            <code class="ruby">            contact.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">        else </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            
            

            

            <code class="ruby">            @error = &quot;Please log in&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">    erb :staff_contact_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            <span class="hits">1</span>
            

            

            <code class="ruby">def get_tickets</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            
            

            

            <code class="ruby">  @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            
            

            

            <code class="ruby">    sql = &quot;SELECT * FROM staff_contacts&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="169">
            
            

            

            <code class="ruby">    result = db.execute(sql)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            
            

            

            <code class="ruby">    @staff_contacts = result.map do |row|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            
            

            

            <code class="ruby">        requestid: row[0],  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            
            

            

            <code class="ruby">        userid: row[1],     </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            
            

            

            <code class="ruby">        email: row[2],      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">        title: row[3],      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">        feedback: row[4]    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            
            

            

            <code class="ruby">    p @staff_contacts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="181">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            
            

            

            <code class="ruby">erb :staff_contact_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="188">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/create-prom-campaign&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            
            

            

            <code class="ruby">    @title = params.fetch(&quot;title&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            
            

            

            <code class="ruby">    @body = params.fetch(&quot;campaign-content&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            
            

            

            <code class="ruby">    @start_date = params.fetch(&quot;start-date&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            
            

            

            <code class="ruby">    @end_date = params.fetch(&quot;end-date&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="193">
            
            

            

            <code class="ruby">    @discount = params.fetch(&quot;discount&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            
            

            

            <code class="ruby">    if Date.parse(@start_date) &lt; Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            
            

            

            <code class="ruby">        @error=&quot;Invalid start date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            
            

            

            <code class="ruby">    elsif Date.parse(@end_date) &lt;Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            
            

            

            <code class="ruby">      @error=&quot;Invalid end date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            
            

            

            <code class="ruby">    elsif Date.parse(@start_date)&gt;Date.parse(@end_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            
            

            

            <code class="ruby">      @error = &quot;Campaign ends before start date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            
            

            

            <code class="ruby">        sql = &quot;SELECT * FROM promotional_campaigns WHERE enddate &gt; ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="205">
            
            

            

            <code class="ruby">        current_campaigns = db.execute(sql,@start_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            
            

            

            <code class="ruby">        if !current_campaigns.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            
            

            

            <code class="ruby">          @error = &quot;Active campaign at that time&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="209">
            
            

            

            <code class="ruby">        campaign=PromotionalCampaign.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            
            

            

            <code class="ruby">        numcampaigns=PromotionalCampaign.all.count()</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            
            

            

            <code class="ruby">        campaign.campaignid=numcampaigns+1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="212">
            
            

            

            <code class="ruby">        campaign.title=@title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="213">
            
            

            

            <code class="ruby">        campaign.content=@body</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="214">
            
            

            

            <code class="ruby">        campaign.managerid=session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="215">
            
            

            

            <code class="ruby">        campaign.discount=@discount</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            
            

            

            <code class="ruby">        campaign.startdate=@start_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            
            

            

            <code class="ruby">        campaign.enddate=@end_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="218">
            
            

            

            <code class="ruby">        campaign.save_changes     </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="222">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">    #should redirect to relevant story page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            
            

            

            <code class="ruby">    erb :staff_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ac583053f67aee1c99a61219262a265bebf2d3e6">
  <div class="header">
    <h3>controllers/store_controller.rb</h3>
    <h4>
      <span class="red">
  58.33%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/store&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @myTitle = &quot;Store&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">    @items = session[&quot;items&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">    erb :store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/payment&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">    @myTitle = &quot;Checkout&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">    erb :payment_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/additem&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            
            

            

            <code class="ruby">    session[&quot;items&quot;] += 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            
            

            

            <code class="ruby">    @items = session[&quot;items&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    erb :store</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="570b775bd3ca6a914792909dac054b6cbcb5f794">
  <div class="header">
    <h3>controllers/story_controller.rb</h3>
    <h4>
      <span class="red">
  10.23%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>88</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>79</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/create-story&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">  @myTitle = &quot;Create&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">  erb :writing_story_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/buy-story/:storyid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            
            

            

            <code class="ruby">  @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">  story_id = params[:storyid].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">  if session[&quot;logged_in&quot;] then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            
            

            

            <code class="ruby">    @user_id = session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            
            

            

            <code class="ruby">      if User.enough_popcorns?(story_id, @user_id) then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            
            

            

            <code class="ruby">        story = Story[storyid: story_id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            
            

            

            <code class="ruby">        user = User[userid: @user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            
            

            

            <code class="ruby">        bought_story = BoughtStory.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            
            

            

            <code class="ruby">        bought_story.storyid = story_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            
            

            

            <code class="ruby">        bought_story.userid = @user_id</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            
            

            

            <code class="ruby">        bought_story.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            
            

            

            <code class="ruby">        user.popcorns -= story.price</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            
            

            

            <code class="ruby">        user.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            
            

            

            <code class="ruby">        redirect &quot;/buy-confirmation/#{story_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            
            

            

            <code class="ruby">        @error = &quot;You don&#39;t have enough popcorns to purchase this story.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            
            

            

            <code class="ruby">  redirect &quot;story_page/#{story_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/buy-confirmation/:storyid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            
            

            

            <code class="ruby">    @story_id = params[:storyid].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            
            

            

            <code class="ruby">    @bought_story_title = Story[@story_id].title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            
            

            

            <code class="ruby">    erb :buy_confirmation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/story-page/:storyid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            
            

            

            <code class="ruby">  @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            
            

            

            <code class="ruby">  story_id = params[:storyid].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            
            

            

            <code class="ruby">  story = Story[storyid: story_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            
            

            

            <code class="ruby">  if session[&quot;logged_in&quot;] then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            
            

            

            <code class="ruby">    @user_id = session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">    user = User[userid: @user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            
            

            

            <code class="ruby">  if session[&quot;logged_in&quot;] &amp;&amp; (BoughtStory.entry_exists?(story_id, @user_id) || story.writerid == @user_id) then</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            
            

            

            <code class="ruby">    @bought_story = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  @title = story.title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            
            

            

            <code class="ruby">  @body = story.content</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            
            

            

            <code class="ruby">  @price = story.price</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  @blurb = story.blurb</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  @genre = story.genre</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  @storyID = story.storyid</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  @writerID = story.writerid</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            
            

            

            <code class="ruby">      sql = &quot;SELECT username FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            
            

            

            <code class="ruby">      @author = db.get_first_value(sql,story.writerid)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            
            

            

            <code class="ruby">  erb :story_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &quot;/submit-story&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            
            

            

            <code class="ruby">    @title = params.fetch(&quot;story-title&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            
            

            

            <code class="ruby">    @body = params.fetch(&quot;story-content&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            
            

            

            <code class="ruby">    @genre = params.fetch(&quot;genre&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            
            

            

            <code class="ruby">    @blurb = params.fetch(&quot;blurb-content&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            
            

            

            <code class="ruby">    @price = params.fetch(&quot;price&quot;,&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            
            

            

            <code class="ruby">    @error = nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            
            

            

            <code class="ruby">    if @price.to_f==0.0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            
            

            

            <code class="ruby">        @error=&quot;Invalid price&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            
            

            

            <code class="ruby">      db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            
            

            

            <code class="ruby">        story=Story.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            
            

            

            <code class="ruby">        numstories=Story.all.count()</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            
            

            

            <code class="ruby">        story.storyid=numstories+1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            
            

            

            <code class="ruby">        story.title=@title</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            
            

            

            <code class="ruby">        story.content=@body</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">        story.price=@price.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            
            

            

            <code class="ruby">        story.blurb=@blurb</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            
            

            

            <code class="ruby">        story.genre=@genre</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            
            

            

            <code class="ruby">        story.releasedate=Date.today.strftime(&quot;%d/%m/%y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            
            

            

            <code class="ruby">        story.writerid=session[&quot;currentuser&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            
            

            

            <code class="ruby">        sql = &quot;SELECT username FROM users WHERE userid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            
            

            

            <code class="ruby">        @author = db.get_first_value(sql,story.writerid)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            
            

            

            <code class="ruby">        @storyID = story.storyid</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            
            

            

            <code class="ruby">        story.save_changes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            
            

            

            <code class="ruby">        session[&quot;logged_in&quot;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            
            

            

            <code class="ruby">    rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            
            

            

            <code class="ruby">      @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            
            

            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            
            

            

            <code class="ruby">      db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby">    #should redirect to relevant story page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            
            

            

            <code class="ruby">    erb :story_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="119">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &quot;/user-stories/:userid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            
            

            

            <code class="ruby">  user_id = params[:userid].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            
            

            

            <code class="ruby">  begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            
            

            

            <code class="ruby">    db = SQLite3::Database.new &#39;database.sqlite3&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            
            

            

            <code class="ruby">      sql = &quot;SELECT title, blurb FROM stories WHERE writerid = ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            
            

            

            <code class="ruby">      result = db.execute(sql,user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            
            

            

            <code class="ruby">      @story_list = result.map do |row|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            
            

            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            
            

            

            <code class="ruby">          title: row[0],  # Assuming requestid is the first column</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">          blurb: row[1],     # Assuming userid is the second column</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">  rescue SQLite3::Exception =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            
            

            

            <code class="ruby">    @error = &quot;Database error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            
            

            

            <code class="ruby">    db.close if db</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            
            

            

            <code class="ruby">  erb :user_stories</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7a2cde6acafe469032eea23dbdad1751dc79cb57">
  <div class="header">
    <h3>models/ActivatedCampaign.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">class ActivatedCampaign &lt; Sequel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1d271a246662da031ef6027f3eb9b1b58a9886aa">
  <div class="header">
    <h3>models/BoughtStory.rb</h3>
    <h4>
      <span class="red">
  66.67%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">class BoughtStory &lt; Sequel::Model(:bought_stories)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            
            

            

            <code class="ruby">    # Method to check if an entry exists for a given story_id and user_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def self.entry_exists?(story_id, user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">      where(storyid: story_id, userid: user_id).count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="237e447ff0850f9fccd566f7a7eb322d32d42fda">
  <div class="header">
    <h3>models/PromotionalCapaign.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">class PromotionalCampaign &lt; Sequel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d2c03c488e374f097ea101d3e5e8c18c3da28c5d">
  <div class="header">
    <h3>models/StaffContact.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">class StaffContact &lt; Sequel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ab210097585b706a7d30d3e56a74b0ec7def4eb8">
  <div class="header">
    <h3>models/Story.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">class Story &lt; Sequel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f7c857a1d0aa15ee14cea20d0867a6c6244d5d3f">
  <div class="header">
    <h3>models/User.rb</h3>
    <h4>
      <span class="red">
  33.33%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;require_all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">class User &lt; Sequel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">    def self.enough_popcorns?(story_id, user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            
            

            

            <code class="ruby">        story = Story[storyid: story_id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            
            

            

            <code class="ruby">        user = User[userid: user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            
            

            

            <code class="ruby">        return false if story.nil? || user.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            
            

            

            <code class="ruby">        popcorns = user.popcorns</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            
            

            

            <code class="ruby">        price = story.price</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            
            

            

            <code class="ruby">        popcorns &gt;= price</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
